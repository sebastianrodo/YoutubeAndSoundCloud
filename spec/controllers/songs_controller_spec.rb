require 'rails_helper'
require 'pry'
require_relative './../shared_examples/youtube_and_soundcloud_base_controller_spec'

RSpec.describe SongsController, type: :routing do
  let(:route) { '/songs' }
  let(:controller) { 'songs' }

  it_behaves_like 'RoutesControllers'
end

RSpec.describe SongsController, type: :controller do
  let(:params) { { q: 'totoy el frio',
                   page: '1' } }
  let!(:client_stub) { SoundcloudService.new }
  let(:service) { SoundcloudService }
  let(:stub_response) do
    [{  "kind"=>"track",
        "id"=>663162527,
        "created_at"=>"2019/08/08 21:55:04 +0000",
        "user_id"=>213496545,
        "duration"=>210749,
        "commentable"=>true,
        "comment_count"=>22,
        "state"=>"finished",
        "original_content_size"=>5057418,
        "last_modified"=>"2020/05/21 04:47:49 +0000",
        "sharing"=>"public",
        "tag_list"=>"sola montano totoy el frio dari beele extended remix edit djs mix intro outro reggeaton dancehall afro barranquilla",
        "permalink"=>"sola-montano-x-totoy-el-frio-x-beele-dex-xtended",
        "streamable"=>true,
        "embeddable_by"=>"all",
        "purchase_url"=>"https://hypeddit.com/track/n5skpo",
        "purchase_title"=>"Free Download",
        "label_id"=>nil,
        "genre"=>"Reguetón",
        "title"=>"Sola - Montano x Totoy El Frio x Beele ( DEX XTENDED)(DESCARGA EN BUY)",
        "description"=>"https://www.instagram.com/dex.pr/",
        "label_name"=>nil,
        "release"=>nil,
        "track_type"=>nil,
        "key_signature"=>nil,
        "isrc"=>nil,
        "video_url"=>nil,
        "bpm"=>nil,
        "release_year"=>nil,
        "release_month"=>nil,
        "release_day"=>nil,
        "original_format"=>"mp3",
        "license"=>"cc-by-nc-sa",
        "uri"=>"https://api.soundcloud.com/tracks/663162527",
        "user"=>
        {"id"=>213496545,
          "kind"=>"user",
          "permalink"=>"deexmusic",
          "username"=>"DEX",
          "last_modified"=>"2020/12/16 19:54:23 +0000",
          "uri"=>"https://api.soundcloud.com/users/213496545",
          "permalink_url"=>"https://soundcloud.com/deexmusic",
          "avatar_url"=>"https://i1.sndcdn.com/avatars-fUGlK10WN54IFIEd-M7e2wA-large.jpg"},
        "user_uri"=>"https://api.soundcloud.com/users/213496545",
        "permalink_url"=>"https://soundcloud.com/deexmusic/sola-montano-x-totoy-el-frio-x-beele-dex-xtended",
        "artwork_url"=>"https://i1.sndcdn.com/artworks-000579804479-ghiovy-large.jpg",
        "stream_url"=>"https://api.soundcloud.com/tracks/663162527/stream",
        "download_url"=>"https://api.soundcloud.com/tracks/663162527/download",
        "waveform_url"=>"https://wave.sndcdn.com/dBVYumaxnI1T_m.png",
        "domain_lockings"=>nil,
        "available_country_codes"=>nil,
        "label"=>nil,
        "secret_token"=>nil,
        "secret_uri"=>nil,
        "user_favorite"=>nil,
        "user_playback_count"=>nil,
        "playback_count"=>346728,
        "download_count"=>0,
        "favoritings_count"=>5809,
        "reposts_count"=>216,
        "downloadable"=>false,
        "downloads_remaining"=>nil},
      {"kind"=>"track",
        "id"=>693399739,
        "created_at"=>"2019/10/09 19:37:15 +0000",
        "user_id"=>713975455,
        "duration"=>201273,
        "commentable"=>true,
        "comment_count"=>32,
        "state"=>"finished",
        "original_content_size"=>35780694,
        "last_modified"=>"2020/06/14 07:28:11 +0000",
        "sharing"=>"public",
        "tag_list"=>"TrapLatino Beéle TotoyElFrio IslandTrap Urbano Latino NuevoMovimiento HIA Elevate Afrobeat SCFIRST",
        "permalink"=>"aguita-e-coco-feat-beele-official-audio",
        "streamable"=>true,
        "embeddable_by"=>"all",
        "purchase_url"=>nil,
        "purchase_title"=>nil,
        "label_id"=>nil,
        "genre"=>"Trap",
        "title"=>"Agüita e' Coco (feat. Beéle) [Official Audio]",
        "description"=>"New song from the fresh Latin urban musical movement out of Barranquilla, Colombia. Coconut water shots for all! :)",
        "label_name"=>"HIA Entertainment",
        "release"=>nil,
        "track_type"=>nil,
        "key_signature"=>nil,
        "isrc"=>nil,
        "video_url"=>nil,
        "bpm"=>nil,
        "release_year"=>2019,
        "release_month"=>10,
        "release_day"=>18,
        "original_format"=>"wav",
        "license"=>"all-rights-reserved",
        "uri"=>"https://api.soundcloud.com/tracks/693399739",
        "user"=>
        {"id"=>713975455,
          "kind"=>"user",
          "permalink"=>"totoy_el_frio_official",
          "username"=>"Totoy El Frio",
          "last_modified"=>"2020/04/14 01:12:01 +0000",
          "uri"=>"https://api.soundcloud.com/users/713975455",
          "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official",
          "avatar_url"=>"https://i1.sndcdn.com/avatars-AdrnyyK8MJ852nge-Rl0mCg-large.jpg"},
        "user_uri"=>"https://api.soundcloud.com/users/713975455",
        "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official/aguita-e-coco-feat-beele-official-audio",
        "artwork_url"=>"https://i1.sndcdn.com/artworks-000610054750-yp9bgu-large.jpg",
        "stream_url"=>"https://api.soundcloud.com/tracks/693399739/stream",
        "download_url"=>"https://api.soundcloud.com/tracks/693399739/download",
        "waveform_url"=>"https://wave.sndcdn.com/iTEQgVxHewHX_m.png",
        "domain_lockings"=>nil,
        "available_country_codes"=>nil,
        "label"=>nil,
        "secret_token"=>nil,
        "secret_uri"=>nil,
        "user_favorite"=>nil,
        "user_playback_count"=>nil,
        "playback_count"=>159380,
        "download_count"=>0,
        "favoritings_count"=>3150,
        "reposts_count"=>55,
        "downloadable"=>false,
        "downloads_remaining"=>nil},
      {"kind"=>"track",
        "id"=>962419600,
        "created_at"=>"2021/01/09 13:54:51 +0000",
        "user_id"=>713975455,
        "duration"=>30000,
        "commentable"=>true,
        "comment_count"=>0,
        "state"=>"finished",
        "original_content_size"=>8709120,
        "last_modified"=>"2021/01/09 13:55:32 +0000",
        "sharing"=>"public",
        "tag_list"=>"Latin/Electronica",
        "permalink"=>"tus-ojos",
        "streamable"=>true,
        "embeddable_by"=>"all",
        "purchase_url"=>nil,
        "purchase_title"=>nil,
        "label_id"=>nil,
        "genre"=>"Latin/Reggaeton",
        "title"=>"Tus Ojos",
        "description"=>nil,
        "label_name"=>"El Grupo B",
        "release"=>nil,
        "track_type"=>nil,
        "key_signature"=>nil,
        "isrc"=>nil,
        "video_url"=>nil,
        "bpm"=>nil,
        "release_year"=>2020,
        "release_month"=>11,
        "release_day"=>13,
        "original_format"=>"mp3",
        "license"=>"all-rights-reserved",
        "uri"=>"https://api.soundcloud.com/tracks/962419600",
        "user"=>
        {"id"=>713975455,
          "kind"=>"user",
          "permalink"=>"totoy_el_frio_official",
          "username"=>"Totoy El Frio",
          "last_modified"=>"2020/04/14 01:12:01 +0000",
          "uri"=>"https://api.soundcloud.com/users/713975455",
          "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official",
          "avatar_url"=>"https://i1.sndcdn.com/avatars-AdrnyyK8MJ852nge-Rl0mCg-large.jpg"},
        "user_uri"=>"https://api.soundcloud.com/users/713975455",
        "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official/tus-ojos",
        "artwork_url"=>"https://i1.sndcdn.com/artworks-Uqx76AbQSbQR-0-large.jpg",
        "stream_url"=>"https://api.soundcloud.com/tracks/962419600/stream",
        "download_url"=>"https://api.soundcloud.com/tracks/962419600/download",
        "waveform_url"=>"https://wave.sndcdn.com/XWagph9foqTn_m.png",
        "domain_lockings"=>nil,
        "available_country_codes"=>nil,
        "label"=>nil,
        "secret_token"=>nil,
        "secret_uri"=>nil,
        "user_favorite"=>nil,
        "user_playback_count"=>nil,
        "playback_count"=>9,
        "download_count"=>0,
        "favoritings_count"=>2,
        "reposts_count"=>0,
        "downloadable"=>false,
        "downloads_remaining"=>nil  }]
  end

  let(:paginated_response) do
    [{  "kind"=>"track",
        "id"=>663162527,
        "created_at"=>"2019/08/08 21:55:04 +0000",
        "user_id"=>213496545,
        "duration"=>210749,
        "commentable"=>true,
        "comment_count"=>22,
        "state"=>"finished",
        "original_content_size"=>5057418,
        "last_modified"=>"2020/05/21 04:47:49 +0000",
        "sharing"=>"public",
        "tag_list"=>"sola montano totoy el frio dari beele extended remix edit djs mix intro outro reggeaton dancehall afro barranquilla",
        "permalink"=>"sola-montano-x-totoy-el-frio-x-beele-dex-xtended",
        "streamable"=>true,
        "embeddable_by"=>"all",
        "purchase_url"=>"https://hypeddit.com/track/n5skpo",
        "purchase_title"=>"Free Download",
        "label_id"=>nil,
        "genre"=>"Reguetón",
        "title"=>"Sola - Montano x Totoy El Frio x Beele ( DEX XTENDED)(DESCARGA EN BUY)",
        "description"=>"https://www.instagram.com/dex.pr/",
        "label_name"=>nil,
        "release"=>nil,
        "track_type"=>nil,
        "key_signature"=>nil,
        "isrc"=>nil,
        "video_url"=>nil,
        "bpm"=>nil,
        "release_year"=>nil,
        "release_month"=>nil,
        "release_day"=>nil,
        "original_format"=>"mp3",
        "license"=>"cc-by-nc-sa",
        "uri"=>"https://api.soundcloud.com/tracks/663162527",
        "user"=>
        {"id"=>213496545,
          "kind"=>"user",
          "permalink"=>"deexmusic",
          "username"=>"DEX",
          "last_modified"=>"2020/12/16 19:54:23 +0000",
          "uri"=>"https://api.soundcloud.com/users/213496545",
          "permalink_url"=>"https://soundcloud.com/deexmusic",
          "avatar_url"=>"https://i1.sndcdn.com/avatars-fUGlK10WN54IFIEd-M7e2wA-large.jpg"},
        "user_uri"=>"https://api.soundcloud.com/users/213496545",
        "permalink_url"=>"https://soundcloud.com/deexmusic/sola-montano-x-totoy-el-frio-x-beele-dex-xtended",
        "artwork_url"=>"https://i1.sndcdn.com/artworks-000579804479-ghiovy-large.jpg",
        "stream_url"=>"https://api.soundcloud.com/tracks/663162527/stream",
        "download_url"=>"https://api.soundcloud.com/tracks/663162527/download",
        "waveform_url"=>"https://wave.sndcdn.com/dBVYumaxnI1T_m.png",
        "domain_lockings"=>nil,
        "available_country_codes"=>nil,
        "label"=>nil,
        "secret_token"=>nil,
        "secret_uri"=>nil,
        "user_favorite"=>nil,
        "user_playback_count"=>nil,
        "playback_count"=>346728,
        "download_count"=>0,
        "favoritings_count"=>5809,
        "reposts_count"=>216,
        "downloadable"=>false,
        "downloads_remaining"=>nil},
      {"kind"=>"track",
        "id"=>693399739,
        "created_at"=>"2019/10/09 19:37:15 +0000",
        "user_id"=>713975455,
        "duration"=>201273,
        "commentable"=>true,
        "comment_count"=>32,
        "state"=>"finished",
        "original_content_size"=>35780694,
        "last_modified"=>"2020/06/14 07:28:11 +0000",
        "sharing"=>"public",
        "tag_list"=>"TrapLatino Beéle TotoyElFrio IslandTrap Urbano Latino NuevoMovimiento HIA Elevate Afrobeat SCFIRST",
        "permalink"=>"aguita-e-coco-feat-beele-official-audio",
        "streamable"=>true,
        "embeddable_by"=>"all",
        "purchase_url"=>nil,
        "purchase_title"=>nil,
        "label_id"=>nil,
        "genre"=>"Trap",
        "title"=>"Agüita e' Coco (feat. Beéle) [Official Audio]",
        "description"=>"New song from the fresh Latin urban musical movement out of Barranquilla, Colombia. Coconut water shots for all! :)",
        "label_name"=>"HIA Entertainment",
        "release"=>nil,
        "track_type"=>nil,
        "key_signature"=>nil,
        "isrc"=>nil,
        "video_url"=>nil,
        "bpm"=>nil,
        "release_year"=>2019,
        "release_month"=>10,
        "release_day"=>18,
        "original_format"=>"wav",
        "license"=>"all-rights-reserved",
        "uri"=>"https://api.soundcloud.com/tracks/693399739",
        "user"=>
        {"id"=>713975455,
          "kind"=>"user",
          "permalink"=>"totoy_el_frio_official",
          "username"=>"Totoy El Frio",
          "last_modified"=>"2020/04/14 01:12:01 +0000",
          "uri"=>"https://api.soundcloud.com/users/713975455",
          "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official",
          "avatar_url"=>"https://i1.sndcdn.com/avatars-AdrnyyK8MJ852nge-Rl0mCg-large.jpg"},
        "user_uri"=>"https://api.soundcloud.com/users/713975455",
        "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official/aguita-e-coco-feat-beele-official-audio",
        "artwork_url"=>"https://i1.sndcdn.com/artworks-000610054750-yp9bgu-large.jpg",
        "stream_url"=>"https://api.soundcloud.com/tracks/693399739/stream",
        "download_url"=>"https://api.soundcloud.com/tracks/693399739/download",
        "waveform_url"=>"https://wave.sndcdn.com/iTEQgVxHewHX_m.png",
        "domain_lockings"=>nil,
        "available_country_codes"=>nil,
        "label"=>nil,
        "secret_token"=>nil,
        "secret_uri"=>nil,
        "user_favorite"=>nil,
        "user_playback_count"=>nil,
        "playback_count"=>159380,
        "download_count"=>0,
        "favoritings_count"=>3150,
        "reposts_count"=>55,
        "downloadable"=>false,
        "downloads_remaining"=>nil},
      {"kind"=>"track",
        "id"=>962419600,
        "created_at"=>"2021/01/09 13:54:51 +0000",
        "user_id"=>713975455,
        "duration"=>30000,
        "commentable"=>true,
        "comment_count"=>0,
        "state"=>"finished",
        "original_content_size"=>8709120,
        "last_modified"=>"2021/01/09 13:55:32 +0000",
        "sharing"=>"public",
        "tag_list"=>"Latin/Electronica",
        "permalink"=>"tus-ojos",
        "streamable"=>true,
        "embeddable_by"=>"all",
        "purchase_url"=>nil,
        "purchase_title"=>nil,
        "label_id"=>nil,
        "genre"=>"Latin/Reggaeton",
        "title"=>"Tus Ojos",
        "description"=>nil,
        "label_name"=>"El Grupo B",
        "release"=>nil,
        "track_type"=>nil,
        "key_signature"=>nil,
        "isrc"=>nil,
        "video_url"=>nil,
        "bpm"=>nil,
        "release_year"=>2020,
        "release_month"=>11,
        "release_day"=>13,
        "original_format"=>"mp3",
        "license"=>"all-rights-reserved",
        "uri"=>"https://api.soundcloud.com/tracks/962419600",
        "user"=>
        {"id"=>713975455,
          "kind"=>"user",
          "permalink"=>"totoy_el_frio_official",
          "username"=>"Totoy El Frio",
          "last_modified"=>"2020/04/14 01:12:01 +0000",
          "uri"=>"https://api.soundcloud.com/users/713975455",
          "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official",
          "avatar_url"=>"https://i1.sndcdn.com/avatars-AdrnyyK8MJ852nge-Rl0mCg-large.jpg"},
        "user_uri"=>"https://api.soundcloud.com/users/713975455",
        "permalink_url"=>"https://soundcloud.com/totoy_el_frio_official/tus-ojos",
        "artwork_url"=>"https://i1.sndcdn.com/artworks-Uqx76AbQSbQR-0-large.jpg",
        "stream_url"=>"https://api.soundcloud.com/tracks/962419600/stream",
        "download_url"=>"https://api.soundcloud.com/tracks/962419600/download",
        "waveform_url"=>"https://wave.sndcdn.com/XWagph9foqTn_m.png",
        "domain_lockings"=>nil,
        "available_country_codes"=>nil,
        "label"=>nil,
        "secret_token"=>nil,
        "secret_uri"=>nil,
        "user_favorite"=>nil,
        "user_playback_count"=>nil,
        "playback_count"=>9,
        "download_count"=>0,
        "favoritings_count"=>2,
        "reposts_count"=>0,
        "downloadable"=>false,
        "downloads_remaining"=>nil  }]
  end

  it_behaves_like 'GetIndexSpec'
end
